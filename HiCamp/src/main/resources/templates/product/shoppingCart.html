<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description"
		content="Responsive Bootstrap4 Shop Template, Created by Imran Hossain from https://imransdesign.com/">

	<!-- title -->
	<title>HiCamp購物車</title>

	<!-- favicon -->
	<link rel="shortcut icon" type="image/png" href="assets/img/favicon.png">
	<!-- google font -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Poppins:400,700&display=swap" rel="stylesheet">
	<!-- fontawesome -->
	<link rel="stylesheet" href="assets/css/all.min.css">
	<!-- bootstrap -->
	<link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
	<!-- owl carousel -->
	<link rel="stylesheet" href="assets/css/owl.carousel.css">
	<!-- magnific popup -->
	<link rel="stylesheet" href="assets/css/magnific-popup.css">
	<!-- animate css -->
	<link rel="stylesheet" href="assets/css/animate.css">
	<!-- mean menu css -->
	<link rel="stylesheet" href="assets/css/meanmenu.min.css">
	<!-- main style -->
	<link rel="stylesheet" href="assets/css/main.css">
	<!-- responsive -->
	<link rel="stylesheet" href="assets/css/responsive.css">
	<style>
		thead td {
			font-size: 20px;
		}

		tbody td {
			font-size: 15px;
		}
	</style>

</head>

<body>
	<div th:replace="~{/layout/frontTopBar}"></div>

	<!-- TopBar breadcrumb-section -->
	<div class="breadcrumb-section breadcrumb-bg">
		<div class="container">
			<div class="row">
				<div class="col-lg-8 offset-lg-2 text-center">
					<div class="breadcrumb-text">
						<p>Wild Adventures</p>
						<h1>Hiking & Camping</h1>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end TopBar breadcrumb section -->

	<!-- latest news -->

	<div class="latest-news mt-150 mb-150" style="margin-top:5px">

		<nav aria-label="breadcrumb" style=" font-size:1.5em;display: block; ">
			<ol class="breadcrumb"
				style="background-color:#fff; margin-left:310px; margin-top:10px; display: flex; flex-wrap: wrap;  ">
				<li class="breadcrumb-item active" aria-current="page"></li>
			</ol>
		</nav>

		<div class="container" style="width:80%;">
			<div class="row">
				<table>
					<thead>
						<tr>
							<td>
								<h2>Hicamp出貨單</h2>
							</td>
							<td></td>
							<td></td>
							<td colspan="3"></td>
						</tr>
						<tr>
							<td>商品名稱</td>
							<td>優惠</td>
							<td>商品數量</td>
							<td>單價</td>
							<td>小計</td>
							<td></td>
						</tr>
					</thead>
					<tbody>
						<th:block th:each="cart : ${cartDTOList}">

							<tr>
								<td th:text="${cart.productName}" style="width:300px;"></td>
								<td style="width:100px;"></td>
								<td>
									<input id="itemQuantity" th:value="${cart.itemQuantity}"
										class="quantity form-control" th:data-id="${cart.cartId}" type="number"
										style="width:90px; margin-top: 2px;" value="1" min="1"
										th:max="${cart.productQuantity}">
								</td>
								<td>
									<input th:value="${cart.productPrice}" id="productPrice" class="productPrice"
										style="outline: none; border: transparent;" readonly>
								</td>
								<td>
									<input type="text" class="unit"
										th:value="${cart.productPrice} * ${cart.itemQuantity}"
										style="width:100%; outline: none; border: transparent;" readonly>
								</td>
								<td>
									<button class="delBtn btn btn-outline-dark" th:data-id="${cart.cartId}">刪除</button>
								</td>
							</tr>
						</th:block>
					</tbody>
				</table>
			</div>
			<div style="display: flex;justify-content: center;">
				<div style="width: 1000px;">
					<div class="card" style="width: 700px;">
						<div class="card-header">
							訂購資訊
						</div>
						<ul class="list-group list-group-flush">
							<li class="list-group-item">
								<table>
									<tr>
										<td>會員姓名：<input type="hidden" id="memberName" th:value="${member.memberName}">
										</td>
										<td th:text="${member.memberName}"></td>
									</tr>
									<tr>
										<td>電子信箱：</td>
										<td th:text="${member.memberEmail}"></td>
									</tr>
									<tr>
										<td>電話：<input type="hidden" id="memberPhone" th:value="${member.memberPhone}">
										</td>
										<td th:text="${member.memberPhone}"></td>
									</tr>
									<tr>
										<td>地址：<input type="hidden" id="memberAddress"
												th:value="${member.memberAddress}">
										</td>
										<td th:text="${member.memberAddress}"></td>
									</tr>
								</table>
							</li>
						</ul>
					</div>
					<div class="card" style="width: 700px;">
						<div class="card-header" style="display: flex; align-items: center;">
							送貨資訊 <span style="margin-left: 50px;"><input type="checkbox" id="thesame">同會員資料</span>

						</div>
						<ul class="list-group list-group-flush">
							<li class="list-group-item">

								<table>
									<tr>
										<td>收件者姓名：</td>
										<td><input type="text" id="orderName" name="orderShipAddress"
												th:value="${member.memberName}"></td>
									</tr>
									<tr>
										<td>電話：</td>
										<td><input type="text" id="orderPhone" name="orderPhone"
												th:value="${member.memberPhone}"></td>
									</tr>
									<tr>
										<td>送貨地址：</td>
										<td><input type="text" id="orderShipAddress" name="orderShipAddress"
												style="width: 100%;" th:value="${member.memberAddress}"></td>
									</tr>
									<tr>
										<td>訂單備註：</td>
										<td><textarea name="orderMessage" id="orderMessage" cols="50" rows="5"
												placeholder="有什麼想對賣家說嗎?"></textarea>
										</td>
									</tr>
								</table>
							</li>
						</ul>
					</div>
				</div>

				<div class="card" style="width: 500px; ">
					<div class="card-header">
						付款資訊
					</div>
					<ul class="list-group list-group-flush">
						<li class="list-group-item">
							<div style="display: flex; justify-content: center;">
								<div style="margin-right: 30px;">
									<h3>Total price</h3>
								</div>
								<div><input type="text" id="orderTotalPrice" name="orderTotalPrice"
										style=" width:100px;outline: none; border: rgb(155, 155, 155); text-align: center;"
										readonly></div>
							</div>
						</li>
					</ul>
					<ul class="list-group list-group-flush">
						<li class="list-group-item">
							<fieldset class="row mb-3" style="font-size: 15px;">
								<legend class="col-form-label col-sm-2 pt-0" style="width: 200px;">付款方式</legend>
								<div class="col-sm-10">
									<div class="form-check">
										<input class="form-check-input" type="radio" name="orderPayWay" id="orderPayWay"
											value="銀行轉帳">
										<label class="form-check-label" for="gridRadios1">
											銀行轉帳
										</label>
									</div>
									<div class="form-check">
										<input class="form-check-input" type="radio" name="orderPayWay" id="orderPayWay"
											value="信用卡" checked>
										<label class="form-check-label" for="gridRadios2">
											信用卡
										</label>
									</div>
								</div>
							</fieldset>

						</li>
					</ul>
					<ul class="list-group list-group-flush">
						<li class="list-group-item">
							<fieldset class="row mb-3" style="font-size: 15px;">
								<legend class="col-form-label col-sm-2 pt-0" style="width: 200px;">運送方式</legend>
								<div class="col-sm-10">
									<div class="form-check">
										<input class="form-check-input" type="checkbox" name="orderShipping"
											id="orderShipping" value="宅配" checked>
										<label class="form-check-label" for="gridRadios1">
											宅配
										</label>
									</div>
								</div>
							</fieldset>
						</li>
					</ul>

					<ul class="list-group list-group-flush" style="justify-content: center; align-items: center;">
						<li class="list-group-item">
							<button id="addOrder" class="btn btn-dark"
								style="width: 300px; margin-top: 20px; font-size: 30px;">下單</button>
						</li>
					</ul>
				</div>
			</div>
		</div>
		<!-- end latest news -->

		<!-- logo carousel -->
		<div class=" logo-carousel-section">
			<div class="container">
				<div class="row">
					<div class="col-lg-12">
						<div class="logo-carousel-inner">
							<div class="single-logo-item">
								<img src="assets/img/company-logos/1.png" alt="">
							</div>
							<div class="single-logo-item">
								<img src="assets/img/company-logos/2.png" alt="">
							</div>
							<div class="single-logo-item">
								<img src="assets/img/company-logos/3.png" alt="">
							</div>
							<div class="single-logo-item">
								<img src="assets/img/company-logos/4.png" alt="">
							</div>
							<div class="single-logo-item">
								<img src="assets/img/company-logos/5.png" alt="">
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- end logo carousel -->

		<div th:replace="~{/layout/frontBottomBar}"></div>

		<script>
			$(function () {
				totalPriceCal();

				//總額
				function totalPriceCal() {
					let unitlist = document.querySelectorAll('.unit');
					let total = 0;
					unitlist.forEach(element => {
						total += parseInt(element.value);
					});
					console.log(total);
					$('#orderTotalPrice').val(total);
				}

				//小計
				$('.quantity').change(function () {
					let qua = $(this).val();
					let price = $(this).parent().next().children("input").val();
					console.log(price);
					let sum = qua * price;
					$(this).parent().next().next().children("input").val(sum);
					let cartID = $(this).attr('data-id');
					let updateQData = {
						"cartId": cartID,
						"itemQuantity": qua
					}
					totalPriceCal();
					setQuantity(updateQData);
				})
				function setQuantity(setQuantityData) {
					$.ajax({
						url: 'http://localhost:8080/HiCamp/shoppingCart/setQuantity',
						type: "post",
						data: setQuantityData,
						success: function () {
							console.log(' 修改成功');
						}

					})

				}
				//同訂購人
				$('#thesame').click(function () {
					let checked = $(this).prop('checked');
					console.log(checked);
					console.log($('#memberName').val());
					$('#orderName').val($('#memberName').val());
					$('#orderPhone').val($('#memberPhone').val());
					$('#orderShipAddress').val($('#memberAddress').val());

				})

				//刪除購物車細項
				$('.delBtn').click(function () {
					let delCartID = $(this).attr('data-id');
					console.log(delCartID);
					delCartItem(delCartID);
					$(this).parents('tr').remove();
				})
				function delCartItem(cartID) {
					axios({
						url: 'http://localhost:8080/HiCamp/shoppingCart/delCartItem',
						method: 'post',
						params: { cartId: cartID }
					})
						.then(res => {
							totalPriceCal();
							console.log('delete goodddddd');
							$("#countCart").text(parseInt($("#countCart").text())-1);
						})
						.catch(err => {
							console.log('delete err' + err);
						})
				}

				//產生訂單明細
				$('#addOrder').click(function () {
					let orderName = $('#orderName').val();
					let orderPhone = $('#orderPhone').val();
					let orderShipAddress = $('#orderShipAddress').val();
					let orderMessage = $('#orderMessage').val();
					let orderTotalPrice = $('#orderTotalPrice').val();
					let orderPayWay = $('input[name=orderPayWay]:checked').val();
					let orderShipping = $('#orderShipping').val();
					let addOrderData = {
						"orderName": orderName,
						"orderPhone": orderPhone,
						"orderShipAddress": orderShipAddress,
						"orderMessage": orderMessage,
						"orderTotalPrice": orderTotalPrice,
						"orderTotalPrice": orderTotalPrice,
						"orderPayWay": orderPayWay,
						"orderShipping": orderShipping
					}
					console.log(addOrderData);
					addOrderAjax(addOrderData);
				})
				function addOrderAjax(addOrderData) {
					$.ajax({
						url: 'http://localhost:8080/HiCamp/orders/addOrder',
						type: "post",
						data: addOrderData,
						success: function () {
							console.log(' 新增訂單成功');
							window.location.href = "http://localhost:8080/HiCamp/orders/getOrder";
						},
						complete: function () {
							window.location.href = "http://localhost:8080/HiCamp/orders/getOrder";
						}

					})
				}
			})

		</script>
		<!-- twzip -->
		<script th:src="@{/hicamp/js/twzipcode.min.js}"></script>
		<script src="https://cdn.jsdelivr.net/npm/tw-city-selector@2.1.1/dist/tw-city-selector.min.js"></script>
		<script src="https://kit.fontawesome.com/a260a05f7c.js" crossorigin="anonymous"></script>
</body>

</html>